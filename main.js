!function(){"use strict";(new class{constructor(){this.errorWin=null}addText(){this.enterText=document.querySelector(".enter-text"),this.rec=document.querySelector(".record"),this.addVoice(),this.addVideo(),this.enterText.addEventListener("keyup",(t=>{if("Enter"===t.key){const t=this.enterText.value.trim();if(""!==t){this.divRec=document.createElement("div"),this.divRec.classList.add("recordText"),this.divRec.textContent=t;const e=document.createElement("div");e.classList.add("recordTime");const i=(new Date).toLocaleString(),s=document.createTextNode(i.slice(0,-3));e.appendChild(s),this.divRec.appendChild(e),this.rec.appendChild(this.divRec),this.geolocation(),this.enterText.value=""}}}))}geolocation(){this.geoPosition=document.createElement("div"),this.geoPosition.classList.add("recordGeo"),navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:i}=t.coords,s=e.toFixed(5),o=i.toFixed(5),c=document.createTextNode(`${s}, ${o}`);this.geoPosition.appendChild(c),this.divRec.appendChild(this.geoPosition),this.rec.appendChild(this.divRec)}),(t=>{if(1===t.code){this.errorWin=document.createElement("div"),this.errorWin.classList.add("error-geolocation"),this.errorWin.classList.toggle("active");const t=document.createElement("div");t.classList.add("error-div"),t.textContent="Что то пошло не так :(";const e=document.createElement("div");e.classList.add("error-div"),e.textContent="К сожалению, нам не удалось получить ваше местоположение, пожалуйста, дайте разрешение на использование геолокации, либо введите координаты вручную.";const i=document.createElement("div");i.classList.add("error-div"),i.textContent="Широта и долгота через запятую. Например: 51.50851, -0.12572",this.errorWin.appendChild(t),this.errorWin.appendChild(e),this.errorWin.appendChild(i),this.inputGeo=document.createElement("input"),this.inputGeo.classList.add("input-text"),this.errorWin.appendChild(this.inputGeo);const s=document.createElement("button");s.classList.add("button-ok"),s.textContent="OK",this.errorWin.appendChild(s);const o=document.createElement("button");o.classList.add("button-cancel"),o.textContent="Отмена",this.errorWin.appendChild(o),this.divRec.appendChild(this.errorWin),this.rec.appendChild(this.divRec),s.addEventListener("click",(()=>{this.regex()})),o.addEventListener("click",(()=>{alert("Введите геопозицию!")}))}}),{enableHighAccuracy:!0})}regex(){const t=this.inputGeo.value;if(/^\[?-?\d{1,2}.\d{5},\s?-?\d{1,2}.\d{5}\]?$/.test(t)){const t=this.inputGeo.value,e=document.createTextNode(t);this.geoPosition.appendChild(e),this.divRec.appendChild(this.geoPosition),this.rec.appendChild(this.divRec),this.errorWin.classList.toggle("active")}else alert("Введена не корректная геопозиция, перепроверьте данные и попробуйте ещё раз.")}addVoice(){let t;this.microIcon=document.querySelector(".microphone-icon"),this.audioPlayer=document.querySelector(".audio"),this.startStop=document.querySelector(".start-stop"),this.stop=document.querySelector(".stop-rec"),this.start=document.querySelector(".start-rec");let e=-1,i=0;this.microIcon.addEventListener("click",(async()=>{this.audioPlayer.classList.toggle("active"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.startStop.classList.toggle("inactive"),t=setInterval((()=>{e++,60===e&&(e=0,i++),this.updateTime(i,e)}),1e3);try{this.streamAudio=await navigator.mediaDevices.getUserMedia({audio:!0}),this.recorderAudio=new MediaRecorder(this.streamAudio);const t=[];this.recorderAudio.addEventListener("dataavailable",(e=>{t.push(e.data)})),this.recorderAudio.addEventListener("stop",(()=>{const e=new Blob(t);this.audioPlayer.src=URL.createObjectURL(e)})),this.recorderAudio.start()}catch(s){console.error("Ошибка при получении аудиопотока:",s),this.audioPlayer.classList.toggle("active"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.startStop.classList.toggle("inactive"),alert("Разрешите использование микрофона устройства."),clearInterval(t),e=-1,i=0}this.flagFalse=!0})),this.stop.addEventListener("click",(()=>{console.log("stop addVoice"),clearInterval(t),e=-1,i=0,this.recorderAudio&&"inactive"!==this.recorderAudio.state&&(this.recorderAudio.stop(),this.audioPlayer.classList.toggle("active"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.startStop.classList.toggle("inactive")),this.streamAudio&&this.streamAudio.getTracks().forEach((t=>t.stop()))})),this.start.addEventListener("click",(()=>{if(this.flagFalse){console.log("start addVoice"),clearInterval(t),e=-1,i=0;const s=document.createElement("audio");s.controls=!0,this.divRec=document.createElement("div"),this.divRec.classList.add("recordVideo"),this.divRec.appendChild(s);const o=document.createElement("div");o.classList.add("recordTime");const c=(new Date).toLocaleString(),a=document.createTextNode(c.slice(0,-3));o.appendChild(a),this.divRec.appendChild(o),this.rec.appendChild(this.divRec),this.geolocation(),this.recorderAudio&&"inactive"!==this.recorderAudio.state&&(this.recorderAudio.stop(),this.recorderAudio.ondataavailable=t=>{s.src=URL.createObjectURL(t.data)}),this.audioPlayer.classList.toggle("active"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.startStop.classList.toggle("inactive"),this.streamAudio&&this.streamAudio.getTracks().forEach((t=>t.stop()))}}))}addVideo(){let t;this.videoIcon=document.querySelector(".video-icon"),this.videoPlayer=document.querySelector(".video"),this.startStop=document.querySelector(".start-stop"),this.stop=document.querySelector(".stop-rec"),this.start=document.querySelector(".start-rec");let e=-1,i=0;this.videoIcon.addEventListener("click",(async()=>{this.videoPlayer.classList.toggle("active"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.startStop.classList.toggle("inactive"),t=setInterval((()=>{e++,60===e&&(e=0,i++),this.updateTime(i,e)}),1e3);try{this.stream=await navigator.mediaDevices.getUserMedia({video:!0}),this.videoPlayer.srcObject=this.stream,this.videoPlayer.addEventListener("canplay",(()=>{this.videoPlayer.play()})),this.recorder=new MediaRecorder(this.stream);const t=[];this.recorder.addEventListener("dataavailable",(e=>{t.push(e.data)})),this.recorder.addEventListener("stop",(()=>{const e=new Blob(t);this.videoPlayer.src=URL.createObjectURL(e)})),this.recorder.start()}catch(s){console.error("Ошибка при получении видеопотока:",s),this.startStop.classList.toggle("inactive"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.videoPlayer.classList.toggle("active"),alert("Разрешите использование видеокамеры устройства."),clearInterval(t),e=-1,i=0}this.flagFalse=!1})),this.stop.addEventListener("click",(()=>{console.log("stop addVideo"),clearInterval(t),e=-1,i=0,this.recorder&&"inactive"!==this.recorder.state&&(this.recorder.stop(),this.startStop.classList.toggle("inactive"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.videoPlayer.classList.toggle("active")),this.stream&&this.stream.getTracks().forEach((t=>t.stop()))})),this.start.addEventListener("click",(()=>{if(!this.flagFalse){console.log("start addVideo"),clearInterval(t),e=-1,i=0;const s=document.createElement("video");s.controls=!0,this.divRec=document.createElement("div"),this.divRec.classList.add("recordVideo"),this.divRec.appendChild(s);const o=document.createElement("div");o.classList.add("recordTime");const c=(new Date).toLocaleString(),a=document.createTextNode(c.slice(0,-3));o.appendChild(a),this.divRec.appendChild(o),this.rec.appendChild(this.divRec),this.geolocation(),this.recorder&&"inactive"!==this.recorder.state&&(this.recorder.stop(),this.recorder.ondataavailable=t=>{s.src=URL.createObjectURL(t.data)}),this.startStop.classList.toggle("inactive"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.videoPlayer.classList.toggle("active"),this.stream&&this.stream.getTracks().forEach((t=>t.stop()))}}))}updateTime(t,e){document.querySelector(".time").textContent=`${t}:${e<10?"0"+e:e}`}}).addText()}();