!function(){"use strict";(new class{constructor(){this.errorWin=null}addText(){this.enterText=document.querySelector(".enter-text"),this.rec=document.querySelector(".record"),this.addVoice(),this.addVideo(),this.enterText.addEventListener("keyup",(e=>{if("Enter"===e.key){const e=this.enterText.value.trim();if(""!==e){this.divRec=document.createElement("div"),this.divRec.classList.add("recordText"),this.divRec.textContent=e;const t=document.createElement("div");t.classList.add("recordTime");const i=(new Date).toLocaleString(),s=document.createTextNode(i.slice(0,-3));t.appendChild(s),this.divRec.appendChild(t),this.rec.appendChild(this.divRec),this.geolocation(),this.enterText.value=""}}}))}geolocation(){this.geoPosition=document.createElement("div"),this.geoPosition.classList.add("recordGeo"),navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:i}=e.coords,s=t.toFixed(5),o=i.toFixed(5),c=document.createTextNode(`${s}, ${o}`);this.geoPosition.appendChild(c),this.divRec.appendChild(this.geoPosition),this.rec.appendChild(this.divRec)}),(e=>{if(1===e.code){this.errorWin=document.createElement("div"),this.errorWin.classList.add("error-geolocation"),this.errorWin.classList.toggle("active");const e=document.createElement("div");e.classList.add("error-div"),e.textContent="Что то пошло не так :(";const t=document.createElement("div");t.classList.add("error-div"),t.textContent="К сожалению, нам не удалось получить ваше местоположение, пожалуйста, дайте разрешение на использование геолокации, либо введите координаты вручную.";const i=document.createElement("div");i.classList.add("error-div"),i.textContent="Широта и долгота через запятую. Например: 51.50851, -0.12572",this.errorWin.appendChild(e),this.errorWin.appendChild(t),this.errorWin.appendChild(i),this.inputGeo=document.createElement("input"),this.inputGeo.classList.add("input-text"),this.errorWin.appendChild(this.inputGeo);const s=document.createElement("button");s.classList.add("button-ok"),s.textContent="OK",this.errorWin.appendChild(s);const o=document.createElement("button");o.classList.add("button-cancel"),o.textContent="Отмена",this.errorWin.appendChild(o),this.divRec.appendChild(this.errorWin),this.rec.appendChild(this.divRec),s.addEventListener("click",(()=>{this.regex()})),o.addEventListener("click",(()=>{alert("Введите геопозицию!")}))}}),{enableHighAccuracy:!0})}regex(){const e=this.inputGeo.value;if(/^\[?-?\d{1,2}.\d{5},\s?-?\d{1,2}.\d{5}\]?$/.test(e)){const e=this.inputGeo.value,t=document.createTextNode(e);this.geoPosition.appendChild(t),this.divRec.appendChild(this.geoPosition),this.rec.appendChild(this.divRec),this.errorWin.classList.toggle("active")}else alert("Введена не корректная геопозиция, перепроверьте данные и попробуйте ещё раз.")}addVoice(){this.microIcon=document.querySelector(".microphone-icon")}addVideo(){let e;this.videoIcon=document.querySelector(".video-icon"),this.videoPlayer=document.querySelector(".video"),this.startStop=document.querySelector(".start-stop"),this.stop=document.querySelector(".stop-rec"),this.start=document.querySelector(".start-rec");let t=-1,i=0;this.videoIcon.addEventListener("click",(async()=>{this.videoPlayer.classList.toggle("active"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.startStop.classList.toggle("inactive"),e=setInterval((()=>{t++,60===t&&(t=0,i++),this.updateTime(i,t)}),1e3);try{this.stream=await navigator.mediaDevices.getUserMedia({video:!0}),this.videoPlayer.srcObject=this.stream,this.videoPlayer.addEventListener("canplay",(()=>{this.videoPlayer.play()})),this.recorder=new MediaRecorder(this.stream);const e=[];this.recorder.addEventListener("dataavailable",(t=>{e.push(t.data)})),this.recorder.addEventListener("stop",(()=>{const t=new Blob(e);this.videoPlayer.src=URL.createObjectURL(t)})),this.recorder.start()}catch(e){console.error("Ошибка при получении видеопотока:",e),this.startStop.classList.toggle("inactive"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.videoPlayer.classList.toggle("active"),alert("Разрешите использование видеокамеры устройства.")}})),this.stop.addEventListener("click",(()=>{clearInterval(e),t=-1,i=0,this.recorder&&"inactive"!==this.recorder.state&&(this.recorder.stop(),this.startStop.classList.toggle("inactive"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.videoPlayer.classList.toggle("active")),this.stream&&this.stream.getTracks().forEach((e=>e.stop()))})),this.start.addEventListener("click",(()=>{clearInterval(e),t=-1,i=0;const s=document.createElement("video");s.controls=!0,this.divRec=document.createElement("div"),this.divRec.classList.add("recordVideo"),this.divRec.appendChild(s);const o=document.createElement("div");o.classList.add("recordTime");const c=(new Date).toLocaleString(),r=document.createTextNode(c.slice(0,-3));o.appendChild(r),this.divRec.appendChild(o),this.rec.appendChild(this.divRec),this.geolocation(),this.recorder&&"inactive"!==this.recorder.state&&(this.recorder.stop(),this.recorder.ondataavailable=e=>{s.src=URL.createObjectURL(e.data)}),this.startStop.classList.toggle("inactive"),this.videoIcon.classList.toggle("active"),this.microIcon.classList.toggle("active"),this.videoPlayer.classList.toggle("active"),this.stream&&this.stream.getTracks().forEach((e=>e.stop()))}))}updateTime(e,t){document.querySelector(".time").textContent=`${e}:${t<10?"0"+t:t}`}}).addText()}();